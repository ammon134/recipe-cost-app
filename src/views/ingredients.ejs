<!-- ingredients.ejs -->
<!DOCTYPE html>
<html lang="en">
<%- include('header') %>

<body>
  <%- include('navbar') %>
  <main class="sm:px-4 py-8 bg-gray-50">
    <h1 class="text-center mb-10">All Ingredients</h1>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <section class="col-span-1 md:col-span-2 px-4">
        <% if (!INGREDIENT_LIST) { %>
        <h2 class="mb-5">No ingredients!</h2>
        <p>Add more using the form on the right.</p>
        <% } else { %>
        <div class="overflow-x-auto relative shadow-md sm:rounded-lg">
          <table id="ingredient_list" class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
            <thead class="text-xs text-white uppercase bg-blue-700 dark:bg-gray-700 dark:text-gray-400">
              <tr>
                <th scope="col" class="py-3 px-6">
                  Ingredient
                </th>
                <th scope="col" class="py-3 px-6">
                  Unit
                </th>
                <th scope="col" class="py-3 px-6">
                  Unit Cost
                </th>
                <th scope="col" class="py-3 px-6">
                  Action
                </th>
              </tr>
            </thead>
            <tbody>

              <% INGREDIENT_LIST.forEach(ingredient => { %>
              <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                <td class="ingredient-name py-4 px-6 text-gray-900 dark:text-white">
                  <div class="flex items-center space-x-3"><%= ingredient.name %></div>
                </td>
                <td class="py-4 px-6 text-gray-900 dark:text-white capitalize">
                  <div class="flex items-center space-x-3"><%= ingredient.unit %></div>
                </td>
                <td class="py-4 px-6 text-gray-900 dark:text-white">
                  <div class="flex items-center space-x-3"><%= ingredient.unitCost %></div>
                </td>
                <td class="py-4 px-6 flex justify-start gap-4">
                  <a href="/ingredients/<%= ingredient.id %>" class="font-medium cursor-pointer text-blue-600 dark:text-blue-500">Edit</a>
                  <input type="submit" value="Delete" onclick="deleteIngredient(<%= ingredient.id %>)" class="remove-button cursor-pointer font-medium text-red-600 dark:text-red-500"></input>
                </td>
              </tr>
              <% }) %>

            </tbody>
          </table>
        </div>
        <% } %>
      </section>
      <section class="col-span-1 md:col-span-1 px-4">
        <div class="shadow-md sm:rounded-lg bg-white p-4">
          <h2 class="mb-4">Add Ingredients</h2>
          <form action="/ingredients" method="POST">
            <div class="">
              <div class="mb-4">
                <label for="ingredient" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Ingredient</label>
                <input type="text" id="ingredient" autofocus autocomplete="off" name="name" placeholder="e.g. Egg" required class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
              </div>
              <div class="mb-4">
                <label for="unit" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Unit</label>
                <select id="unit" name="unit" required class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                  <option selected>Choose a Unit</option>
                  <% SUPPORTED_UNITS.forEach(unit => { %>
                  <option value="<%= unit.symbol %>"><%= unit.name %></option>
                  <% }) %>
                </select>
              </div>
              <div class="mb-4">
                <label for="unitCost" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cost per Unit
                  (1,000 VND)</label>
                <input type="number" id="unitCost" name="unitCost" placeholder="5" required class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
              </div>
            </div>
            <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Save</button>
          </form>
        </div>
      </section>
    </div>
  </main>
  <script>
    // Send delete ingredient request
    const deleteIngredient = async (id) => {
      if (confirm('Are you sure you want to delete this ingredient?')) {
        try {
          const res = await fetch(`/ingredients/${id}`, {
            method: 'DELETE'
          });
          if (!res.ok) {
            alert('Something went wrong, please try again later.')
          }
          console.log(res)
        } catch (error) {
          console.log(error)
        }
      }
    }
  </script>
</body>

</html>